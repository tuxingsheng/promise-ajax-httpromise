{"version":3,"file":null,"sources":["../../src/httpromise/module/async.js","../../src/httpromise/module/promise.js","../../src/httpromise/module/ajax.js","../../src/httpromise/index.js"],"sourcesContent":["'use strict';\r\nlet queue = [];\r\n\r\nexport const async = (callback)=> {\r\n    queue.push(callback);\r\n    if (queue.length == 1) {\r\n        setTimeout(run, 0);\r\n    }\r\n};\r\n\r\nconst run = ()=> {\r\n    while (queue.length) {\r\n        queue[0]();\r\n        queue.shift();\r\n    }\r\n};\r\n","import {async} from './async';\r\n\r\nconst PENDING = 'pending';\r\nconst RESOLVED = 'resolved';\r\nconst REJECTED = 'rejected';\r\n\r\n\r\nexport function Promise(executor) {\r\n    this.defers = [];\r\n    // 设置默认状态\r\n    this.state = PENDING;\r\n    // 初始值为undefined\r\n    this.value = undefined;\r\n\r\n    var promise = this;\r\n\r\n    // 无法准确的判断传入的是否是一个包含了resolve和reject的函数\r\n    // 因此，只能通过try-catch进行处理\r\n    try {\r\n        executor(function (x) {\r\n            promise.resolve(x);\r\n        }, function (r) {\r\n            promise.reject(r);\r\n        });\r\n    } catch (e) {\r\n        promise.reject(e);\r\n    }\r\n}\r\n\r\nPromise.resolve = function (x) {\r\n    return new Promise(function (resolve, reject) {\r\n        resolve(x);\r\n    });\r\n};\r\n\r\nPromise.reject = function (r) {\r\n    return new Promise(function (resolve, reject) {\r\n        reject(r);\r\n    });\r\n};\r\n\r\nPromise.all = function (iterable) {\r\n    return new Promise(function (resolve, reject) {\r\n        let count = 0,\r\n            result = [];\r\n\r\n        if (iterable.length === 0) {\r\n            resolve(result);\r\n        }\r\n\r\n        function resolver(i) {\r\n            return function (x) {\r\n                result[i] = x;\r\n                count += 1;\r\n\r\n                if (count === iterable.length) {\r\n                    resolve(result);\r\n                }\r\n            };\r\n        }\r\n\r\n        for (let i = 0; i < iterable.length; i++) {\r\n            Promise.resolve(iterable[i]).then(resolver(i), reject);\r\n        }\r\n    })\r\n};\r\n\r\nPromise.race = function (iterable) {\r\n    return new Promise(function (resolve, reject) {\r\n        for (let i = 0; i < iterable.length; i++) {\r\n            Promise.resolve(iterable[i]).then(resolve, reject);\r\n        }\r\n    });\r\n};\r\n\r\nconst $promise = Promise.prototype;\r\n\r\n$promise.constructor = Promise;\r\n\r\n$promise.resolve = function (x) {\r\n    const promise = this;\r\n\r\n    if (x != promise) {\r\n\r\n        // 如果传入的是一个Promise\r\n        if (x instanceof Promise) {\r\n\r\n            let called = false,\r\n                then = x && x['then'];\r\n\r\n            if (x && typeof x === 'object' && typeof then === 'function') {\r\n                then.call(x, function (x) {\r\n                    if (!called) {\r\n                        promise.resolve(x);\r\n                    }\r\n                    called = true;\r\n                }, function (r) {\r\n                    if (!called) {\r\n                        promise.reject(r);\r\n                    }\r\n                    called = true;\r\n                });\r\n                return;\r\n            }\r\n        }\r\n\r\n        promise.state = RESOLVED;\r\n        promise.value = x;\r\n        promise.notify();\r\n    }\r\n};\r\n\r\n$promise.reject = function (r) {\r\n    const promise = this;\r\n\r\n    if (r != promise) {\r\n        promise.state = REJECTED;\r\n        promise.value = r;\r\n        promise.notify();\r\n    }\r\n};\r\n\r\n$promise.then = function (onResolved, onRejected) {\r\n    const promise = this;\r\n\r\n    return new Promise(function (resolve, reject) {\r\n        promise.defers.push({\r\n            onResolved: onResolved,\r\n            onRejected: onRejected,\r\n            resolve: resolve,\r\n            reject: reject\r\n        });\r\n        promise.notify();\r\n    });\r\n};\r\n\r\n$promise.catch = function (onRejected) {\r\n    return this.then(undefined, onRejected);\r\n};\r\n\r\n$promise.notify = function () {\r\n    const promise = this;\r\n\r\n    async(function () {\r\n        if (promise.state != PENDING) {\r\n            while (promise.defers.length) {\r\n                let defer = promise.defers.shift(),\r\n                    onResolved = defer.onResolved,\r\n                    onRejected = defer.onRejected,\r\n                    resolve = defer.resolve,\r\n                    reject = defer.reject;\r\n\r\n                // 如果是resolve状态\r\n                if (promise.state === RESOLVED) {\r\n                    if (isFunction(onResolved)) {\r\n                        resolve(onResolved.call(null, promise.value));\r\n                    } else {\r\n                        resolve(promise.value);\r\n                    }\r\n                }\r\n\r\n                // 如果是reject状态\r\n                if (promise.state === REJECTED) {\r\n                    if (isFunction(onRejected)) {\r\n                        reject(onRejected.call(null, promise.value));\r\n                    } else {\r\n                        reject(promise.value);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nfunction isFunction(obj) {\r\n    return typeof obj === 'function';\r\n}\r\n","import {Promise} from './promise';\r\n\r\nexport function $http() {\r\n\r\n}\r\n\r\n$http.prototype.constructor = $http;\r\n\r\n$http.prototype.all = function (iterable) {\r\n    return Promise.all(iterable);\r\n};\r\n\r\n$http.prototype.race = function (iterable) {\r\n    return Promise.race(iterable);\r\n};\r\n\r\n$http.prototype.post = function (url, options) {\r\n    http.ajaxSettings.type = 'POST';\r\n    return this.ajax(url, options)\r\n};\r\n\r\n$http.prototype.get = function (url, options) {\r\n    http.ajaxSettings.type = 'GET';\r\n    return this.ajax(url, options)\r\n};\r\n\r\n$http.prototype.put = function (url, options) {\r\n    http.ajaxSettings.type = 'PUT';\r\n    return this.ajax(url, options)\r\n};\r\n\r\n$http.prototype.delete = function (url, options) {\r\n    http.ajaxSettings.type = 'DELETE';\r\n    return this.ajax(url, options)\r\n};\r\n\r\n$http.prototype.ajax = function (url, options) {\r\n    if (typeof url === 'object') {\r\n        options = url;\r\n        url = undefined;\r\n    }\r\n    return new Promise(function (resolve, reject) {\r\n        http.ajax(url, options, resolve, reject);\r\n    });\r\n};\r\n\r\nvar http = {};\r\n\r\nhttp.jsonType = 'application/json';\r\n\r\nhttp.htmlType = 'text/html';\r\n\r\nhttp.rscript = /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi;\r\n\r\nhttp.scriptTypeRE = /^(?:text|application)\\/javascript/i;\r\n\r\nhttp.xmlTypeRE = /^(?:text|application)\\/xml/i;\r\n\r\nhttp.blankRE = /^\\s*$/;\r\n\r\nhttp.ajaxSettings = {\r\n    type: 'GET',\r\n    beforeSend: noop,\r\n    context: null,\r\n    xhr: function (protocol) {\r\n        return new window.XMLHttpRequest();\r\n    },\r\n    accepts: {\r\n        script: 'text/javascript, application/javascript, application/x-javascript',\r\n        json: http.jsonType,\r\n        xml: 'application/xml, text/xml',\r\n        html: http.htmlType,\r\n        text: 'text/plain'\r\n    },\r\n    timeout: 0,\r\n    processData: true,\r\n    cache: true\r\n};\r\n\r\nhttp.ajaxBeforeSend = function (xhr, settings) {\r\n    var context = settings.context;\r\n    if (settings.beforeSend.call(context, xhr, settings) === false) {\r\n        return false;\r\n    }\r\n};\r\n\r\nhttp.serialize = function (params, obj, traditional, scope) {\r\n    var type, array = isArray(obj),\r\n        hash = isPlainObject(obj);\r\n    each(obj, function (key, value) {\r\n        type = $type(value);\r\n        if (scope) {\r\n            key = traditional ? scope :\r\n            scope + '[' + (hash || type === 'object' || type === 'array' ? key : '') + ']';\r\n        }\r\n        // handle data in serializeArray() format\r\n        if (!scope && array) {\r\n            params.add(value.name, value.value);\r\n        }\r\n        // recurse into nested objects\r\n        else if (type === 'array' || (!traditional && type === 'object')) {\r\n            http.serialize(params, value, traditional, key);\r\n        } else {\r\n            params.add(key, value);\r\n        }\r\n    });\r\n};\r\n\r\nhttp.serializeData = function (options) {\r\n    if (options.processData && options.data && typeof options.data !== 'string') {\r\n        options.data = $param(options.data, options.traditional);\r\n    }\r\n    if (options.data && (!options.type || options.type.toUpperCase() === 'GET')) {\r\n        options.url = http.appendQuery(options.url, options.data);\r\n        options.data = undefined;\r\n    }\r\n};\r\n\r\nhttp.appendQuery = function (url, query) {\r\n    if (query === '') {\r\n        return url;\r\n    }\r\n    return (url + '&' + query).replace(/[&?]{1,2}/, '?');\r\n};\r\n\r\nhttp.mimeToDataType = function (mime) {\r\n    if (mime) {\r\n        mime = mime.split(';', 2)[0];\r\n    }\r\n    return mime && (mime === http.htmlType ? 'html' :\r\n            mime === http.jsonType ? 'json' :\r\n                scriptTypeRE.test(mime) ? 'script' :\r\n                xmlTypeRE.test(mime) && 'xml') || 'text';\r\n};\r\n\r\nhttp.parseArguments = function (url, data, success, dataType) {\r\n    if (isFunction(data)) {\r\n        dataType = success, success = data, data = undefined;\r\n    }\r\n    if (!isFunction(success)) {\r\n        dataType = success, success = undefined;\r\n    }\r\n    return {\r\n        url: url,\r\n        data: data,\r\n        success: success,\r\n        dataType: dataType\r\n    };\r\n};\r\n\r\nhttp.ajax = function (url, options, resolve, reject) {\r\n    var settings = options || {};\r\n    settings.url = url || settings.url;\r\n    for (var key in http.ajaxSettings) {\r\n        if (settings[key] === undefined) {\r\n            settings[key] = http.ajaxSettings[key];\r\n        }\r\n    }\r\n    http.serializeData(settings);\r\n    var dataType = settings.dataType;\r\n\r\n    if (settings.cache === false || ((!options || options.cache !== true) && ('script' === dataType))) {\r\n        settings.url = http.appendQuery(settings.url, '_=' + $.now());\r\n    }\r\n    var mime = settings.accepts[dataType && dataType.toLowerCase()];\r\n    var headers = {};\r\n    var setHeader = function (name, value) {\r\n        headers[name.toLowerCase()] = [name, value];\r\n    };\r\n    var protocol = /^([\\w-]+:)\\/\\//.test(settings.url) ? RegExp.$1 : window.location.protocol;\r\n    var xhr = settings.xhr(settings);\r\n    var nativeSetHeader = xhr.setRequestHeader;\r\n    var abortTimeout;\r\n\r\n    setHeader('X-Requested-With', 'XMLHttpRequest');\r\n    setHeader('Accept', mime || '*/*');\r\n    if (!!(mime = settings.mimeType || mime)) {\r\n        if (mime.indexOf(',') > -1) {\r\n            mime = mime.split(',', 2)[0];\r\n        }\r\n        xhr.overrideMimeType && xhr.overrideMimeType(mime);\r\n    }\r\n    if (settings.contentType || (settings.contentType !== false && settings.data && settings.type.toUpperCase() !== 'GET')) {\r\n        setHeader('Content-Type', settings.contentType || 'application/x-www-form-urlencoded');\r\n    }\r\n    if (settings.headers) {\r\n        for (var name in settings.headers)\r\n            setHeader(name, settings.headers[name]);\r\n    }\r\n    xhr.setRequestHeader = setHeader;\r\n\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState === 4) {\r\n            xhr.onreadystatechange = noop;\r\n            clearTimeout(abortTimeout);\r\n            var result, error = false;\r\n            var isLocal = protocol === 'file:';\r\n            if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304 || (xhr.status === 0 && isLocal && xhr.responseText)) {\r\n                dataType = dataType || http.mimeToDataType(settings.mimeType || xhr.getResponseHeader('content-type'));\r\n                result = xhr.responseText;\r\n                try {\r\n                    // http://perfectionkills.com/global-eval-what-are-the-options/\r\n                    if (dataType === 'script') {\r\n                        (1, eval)(result);\r\n                    } else if (dataType === 'xml') {\r\n                        result = xhr.responseXML;\r\n                    } else if (dataType === 'json') {\r\n                        result = http.blankRE.test(result) ? null : parseJSON(result);\r\n                    }\r\n                } catch (e) {\r\n                    error = e;\r\n                }\r\n\r\n                if (error) {\r\n                    reject({\r\n                        error: error,\r\n                        status: 'parsererror',\r\n                        xhr: xhr,\r\n                        settings: settings\r\n                    });\r\n                } else {\r\n                    resolve(result);\r\n                }\r\n            } else {\r\n                var status = xhr.status ? 'error' : 'abort';\r\n                var statusText = xhr.statusText || null;\r\n                if (isLocal) {\r\n                    status = 'error';\r\n                    statusText = '404';\r\n                }\r\n                reject({\r\n                    error: statusText,\r\n                    status: status,\r\n                    xhr: xhr,\r\n                    settings: settings\r\n                });\r\n            }\r\n        }\r\n    };\r\n    if (http.ajaxBeforeSend(xhr, settings) === false) {\r\n        xhr.abort();\r\n        reject({\r\n            error: null,\r\n            status: 'abort',\r\n            xhr: xhr,\r\n            settings: settings\r\n        });\r\n        return xhr;\r\n    }\r\n\r\n    if (settings.xhrFields) {\r\n        for (var name in settings.xhrFields) {\r\n            xhr[name] = settings.xhrFields[name];\r\n        }\r\n    }\r\n\r\n    var async = 'async' in settings ? settings.async : true;\r\n\r\n    xhr.open(settings.type.toUpperCase(), settings.url, async, settings.username, settings.password);\r\n\r\n    for (var name in headers) {\r\n        nativeSetHeader.apply(xhr, headers[name]);\r\n    }\r\n    if (settings.timeout > 0) {\r\n        abortTimeout = setTimeout(function () {\r\n            xhr.onreadystatechange = noop;\r\n            xhr.abort();\r\n            reject({\r\n                error: null,\r\n                status: 'timeout',\r\n                xhr: xhr,\r\n                settings: settings\r\n            });\r\n        }, settings.timeout);\r\n    }\r\n    xhr.send(settings.data ? settings.data : null);\r\n    return xhr;\r\n};\r\n\r\nvar isArray = Array.isArray;\r\nvar parseJSON = JSON.parse;\r\nvar class2type = {};\r\n\r\neach(['Boolean', 'Number', 'String', 'Function', 'Array', 'Date', 'RegExp', 'Object', 'Error'], function (i, name) {\r\n    class2type['[object ' + name + ']'] = name.toLowerCase();\r\n});\r\n\r\nfunction $type(obj) {\r\n    return obj == null ? String(obj) : class2type[{}.toString.call(obj)] || 'object';\r\n}\r\n\r\nfunction $param(obj, traditional) {\r\n    var params = [];\r\n    params.add = function (k, v) {\r\n        this.push(encodeURIComponent(k) + '=' + encodeURIComponent(v));\r\n    };\r\n    http.serialize(params, obj, traditional);\r\n    return params.join('&').replace(/%20/g, '+');\r\n}\r\n\r\nfunction $isPromise(obj) {\r\n    var i;\r\n    if (isArray(obj)) {\r\n        for (i = 0; i < obj.length; i++) {\r\n            if (!(obj[i] instanceof Promise)) {\r\n                wran(obj[i] + ' 的instanceof不是Promise！！！')\r\n            }\r\n        }\r\n    } else if (isObject(obj)) {\r\n        for (i in obj) {\r\n            if (!(obj[i] instanceof Promise)) {\r\n                wran(obj[i] + ' 的instanceof不是Promise！！！')\r\n            }\r\n        }\r\n    } else {\r\n        if (!(obj instanceof Promise)) {\r\n            wran(obj + ' 的instanceof不是Promise！！！')\r\n        }\r\n    }\r\n    return obj;\r\n}\r\n\r\nfunction isObject(obj) {\r\n    return obj !== null && typeof obj === 'object';\r\n}\r\n\r\nfunction isPlainObject(obj) {\r\n    return isObject(obj) && Object.getPrototypeOf(obj) == Object.prototype;\r\n}\r\n\r\nfunction each(elements, callback, hasOwnProperty) {\r\n    if (!elements) {\r\n        return this;\r\n    }\r\n    if (typeof elements.length === 'number') {\r\n        [].every.call(elements, function (el, idx) {\r\n            return callback.call(el, idx, el) !== false;\r\n        })\r\n    } else {\r\n        for (var key in elements) {\r\n            if (hasOwnProperty) {\r\n                if (ele.hasOwnProperty(key)) {\r\n                    if (callback.call(elements[key], key, elements[key]) === false) {\r\n                        return elements;\r\n                    }\r\n                }\r\n            } else {\r\n                if (callback.call(elements[key], key, elements[key]) === false) return elements;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction wran(str) {\r\n    console.error(str);\r\n}\r\n\r\nfunction noop() {\r\n\r\n}\r\n\r\n\r\n","import {$http} from './module/ajax';\r\n\r\nexport default new $http();\r\n"],"names":["queue","async","callback","push","length","run","shift","PENDING","RESOLVED","REJECTED","Promise","executor","defers","state","value","undefined","promise","x","resolve","r","reject","e","all","iterable","count","result","resolver","i","then","race","$promise","prototype","constructor","called","call","notify","onResolved","onRejected","catch","defer","isFunction","obj","$http","post","url","options","ajaxSettings","type","ajax","get","put","delete","http","jsonType","htmlType","rscript","scriptTypeRE","xmlTypeRE","blankRE","noop","protocol","window","XMLHttpRequest","ajaxBeforeSend","xhr","settings","context","beforeSend","serialize","params","traditional","scope","array","isArray","hash","isPlainObject","key","$type","add","name","serializeData","processData","data","$param","toUpperCase","appendQuery","query","replace","mimeToDataType","mime","split","test","parseArguments","success","dataType","cache","$","now","accepts","toLowerCase","headers","setHeader","RegExp","$1","location","nativeSetHeader","setRequestHeader","abortTimeout","mimeType","indexOf","overrideMimeType","contentType","onreadystatechange","readyState","error","isLocal","status","responseText","getResponseHeader","eval","responseXML","parseJSON","statusText","abort","xhrFields","open","username","password","apply","timeout","setTimeout","send","Array","JSON","parse","class2type","each","String","toString","k","v","encodeURIComponent","join","isObject","Object","getPrototypeOf","elements","hasOwnProperty","every","el","idx","ele","wran","str"],"mappings":"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"}