{"version":3,"file":null,"sources":["../../src/promise/module/async.js","../../src/promise/module/promise.js"],"sourcesContent":["'use strict';\r\nlet queue = [];\r\n\r\nexport function async(callback) {\r\n    queue.push(callback);\r\n    if (queue.length == 1) {\r\n        setTimeout(run, 0);\r\n    }\r\n}\r\n\r\nfunction run() {\r\n    while (queue.length) {\r\n        queue[0]();\r\n        queue.shift();\r\n    }\r\n}\r\n","import {async} from './async';\r\n\r\nconst PENDING = 'pending';\r\nconst RESOLVED = 'resolved';\r\nconst REJECTED = 'rejected';\r\n\r\n\r\nexport function Promise(executor) {\r\n    this.defers = [];\r\n    // 设置默认状态\r\n    this.state = PENDING;\r\n    // 初始值为undefined\r\n    this.value = undefined;\r\n\r\n    var promise = this;\r\n\r\n    // 无法准确的判断传入的是否是一个包含了resolve和reject的函数\r\n    // 因此，只能通过try-catch进行处理\r\n    try {\r\n        executor(function (x) {\r\n            promise.resolve(x);\r\n        }, function (r) {\r\n            promise.reject(r);\r\n        });\r\n    } catch (e) {\r\n        promise.reject(e);\r\n    }\r\n}\r\n\r\nPromise.resolve = function (x) {\r\n    return new Promise(function (resolve, reject) {\r\n        resolve(x);\r\n    });\r\n};\r\n\r\nPromise.reject = function (r) {\r\n    return new Promise(function (resolve, reject) {\r\n        reject(r);\r\n    });\r\n};\r\n\r\n\r\nvar $promise = Promise.prototype;\r\n\r\n$promise.constructor = Promise;\r\n\r\n$promise.resolve = function (x) {\r\n    const promise = this;\r\n\r\n    if (x != promise) {\r\n        promise.state = RESOLVED;\r\n        promise.value = x;\r\n        promise.notify();\r\n    }\r\n};\r\n\r\n$promise.reject = function (r) {\r\n    const promise = this;\r\n\r\n    if (r != promise) {\r\n        promise.state = REJECTED;\r\n        promise.value = r;\r\n        promise.notify();\r\n    }\r\n};\r\n\r\n$promise.then = function (onResolved, onRejected) {\r\n    const promise = this;\r\n\r\n    return new Promise(function (resolve, reject) {\r\n        promise.defers.push({\r\n            onResolved: onResolved,\r\n            onRejected: onRejected,\r\n            resolve: resolve,\r\n            reject: reject\r\n        });\r\n        promise.notify();\r\n    });\r\n};\r\n\r\n$promise.catch = function (onRejected) {\r\n    return this.then(undefined, onRejected);\r\n};\r\n\r\n$promise.notify = function () {\r\n    const promise = this;\r\n\r\n    async(function () {\r\n        if (promise.state != PENDING) {\r\n            while (promise.defers.length) {\r\n                let defer = promise.defers.shift(),\r\n                    onResolved = defer.onResolved,\r\n                    onRejected = defer.onRejected,\r\n                    resolve = defer.resolve,\r\n                    reject = defer.reject;\r\n\r\n                // 如果是resolve状态\r\n                if (promise.state === RESOLVED) {\r\n                    if (isFunction(onResolved)) {\r\n                        resolve(onResolved.call(null, promise.value));\r\n                    } else {\r\n                        resolve(promise.value);\r\n                    }\r\n                }\r\n\r\n                // 如果是reject状态\r\n                if (promise.state === REJECTED) {\r\n                    if (isFunction(onRejected)) {\r\n                        reject(onRejected.call(null, promise.value));\r\n                    } else {\r\n                        reject(promise.value);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n\r\nfunction isFunction(obj) {\r\n    return typeof obj === 'function';\r\n}\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["queue","async","callback","push","length","run","shift","PENDING","RESOLVED","REJECTED","Promise","executor","defers","state","value","undefined","promise","x","resolve","r","reject","e","$promise","prototype","constructor","notify","then","onResolved","onRejected","catch","defer","isFunction","call","obj"],"mappings":"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"}