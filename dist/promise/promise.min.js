!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Promise=t()}(this,function(){"use strict";function e(e){i.push(e),1==i.length&&setTimeout(t,0)}function t(){for(;i.length;)i[0](),i.shift()}function n(e){this.defers=[],this.state=r,this.value=void 0;var t=this;try{e(function(e){t.resolve(e)},function(e){t.reject(e)})}catch(e){t.reject(e)}}function o(e){return"function"==typeof e}var i=[],r="pending",u="resolved",f="rejected";n.resolve=function(e){return new n(function(t,n){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})};var c=n.prototype;return c.constructor=n,c.resolve=function(e){var t=this;e!=t&&(t.state=u,t.value=e,t.notify())},c.reject=function(e){var t=this;e!=t&&(t.state=f,t.value=e,t.notify())},c.then=function(e,t){var o=this;return new n(function(n,i){o.defers.push({onResolved:e,onRejected:t,resolve:n,reject:i}),o.notify()})},c.catch=function(e){return this.then(void 0,e)},c.notify=function(){var t=this;e(function(){if(t.state!=r)for(;t.defers.length;){var e=t.defers.shift(),n=e.onResolved,i=e.onRejected,c=e.resolve,s=e.reject;t.state===u&&c(o(n)?n.call(null,t.value):t.value),t.state===f&&s(o(i)?i.call(null,t.value):t.value)}})},n});
