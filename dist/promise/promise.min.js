!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Promise=t()}(this,function(){"use strict";function e(e){r.push(e),1==r.length&&setTimeout(t,0)}function t(){for(;r.length;)r[0](),r.shift()}function n(e){this.defers=[],this.state=i,this.value=void 0;var t=this;try{e(function(e){t.resolve(e)},function(e){t.reject(e)})}catch(e){t.reject(e)}}function o(e){return"function"==typeof e}var r=[],f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i="pending",u="resolved",c="rejected";n.resolve=function(e){return new n(function(t,n){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})},n.all=function(e){return new n(function(t,o){function r(n){return function(o){i[n]=o,f+=1,f===e.length&&t(i)}}var f=0,i=[];0===e.length&&t(i);for(var u=0;u<e.length;u++)n.resolve(e[u]).then(r(u),o)})},n.race=function(e){return new n(function(t,o){for(var r=0;r<e.length;r++)n.resolve(e[r]).then(t,o)})};var l=n.prototype;return l.constructor=n,l.resolve=function(e){var t=this;if(e!=t){if(e instanceof n){var o=function(){var n=!1,o=e&&e.then;if(e&&"object"===("undefined"==typeof e?"undefined":f(e))&&"function"==typeof o)return o.call(e,function(e){n||t.resolve(e),n=!0},function(e){n||t.reject(e),n=!0}),{v:void 0}}();if("object"===("undefined"==typeof o?"undefined":f(o)))return o.v}t.state=u,t.value=e,t.notify()}},l.reject=function(e){var t=this;e!=t&&(t.state=c,t.value=e,t.notify())},l.then=function(e,t){var o=this;return new n(function(n,r){o.defers.push({onResolved:e,onRejected:t,resolve:n,reject:r}),o.notify()})},l.catch=function(e){return this.then(void 0,e)},l.notify=function(){var t=this;e(function(){if(t.state!=i)for(;t.defers.length;){var e=t.defers.shift(),n=e.onResolved,r=e.onRejected,f=e.resolve,l=e.reject;t.state===u&&f(o(n)?n.call(null,t.value):t.value),t.state===c&&l(o(r)?r.call(null,t.value):t.value)}})},n});
